# 调试与异常处理方法论

有时，因为特定的的错误（无论是人为的，还是偶然发生的），RPA 流程可能无法执行。为了处理这种情况，我们需要调试及处理这些异常。下文就此展开介绍常见的错误以及如何调试和处理异常。

## 错误分类

在编写 RPA 流程时，经常会遇到各种各样地错误，这些错误中有些容易发现和解决，有些则比较隐蔽甚至很难发现。总体上可以归纳为三类：语法错误、逻辑错误和运行时错误。

- 【语法错误】：指不符合指定语法规则的程序错误。例如，变量名的拼写错误、数据类型错误、标点符号的丢失、括号不匹配等。语法错误是三类错误中最容易发现也是最容易解决的一类错误，发生在流程的编写过程中。
- 【逻辑错误】：当应用程序未按照预期方式执行会产生逻辑错误。这种一般是语法没错，由于错误的算法引起，如，结果不对，公式不对等。这种错误是最难的。
- 【运行错误】：是指在程序运行期间执行了非法操作或者某些操作失败。如，需要打开的文件找不到，内存泄漏，以零做除数这些异常只有在运行的时候才能表现出来。

## 调试的原理及概念

调试是将编写好了的流程在投入实际运行前，用手工试运行方法进行测试，修正语法错误和逻辑错误的过程。
根据测试时所发现的错误信息和利用调试工具追踪的提示信息，两者相互结合综合判断错误发生原因和位置。找出错误原因和具体的错误位置*，最终方便进行修正。

## 调试的原则

1. 理清流程的业务逻辑。
2. 分析思考与错误现象有关的提示信息。
3. 同一个问题验证完成，办法行不通时需要换种思路处理问题。
4. 利用调试工具，理清流程中数据流转逻辑，辅助定位错误。
5. 找到错误的根源，才能解决实际问题。

## 使用云扩 RPA 编辑器调试错误

### 异常与错误捕获

异常是在流程运行时发生的不正常情况。 异常通常表示有需要调试的问题。 发生异常时，调试器将向“输出”窗口中写入一条异常消息，可通过异常消息定位问题发生位置与原因。
异常处理是用来处理 RPA 流程未能执行或意外中断的方式。为了处理 RPA 流程的异常，我们需要使用 "错误捕获（Try Catch）" 组件。
在组件面板的“流程控制”分类中，找到 "错误捕获（Try Catch）" 组件，拖入至编辑区域中，将可能发生异常的组件包含于错误捕获组件中。

错误捕获由以下几部分组成：

- Try：组件执行过程中可能抛出的异常
- Catches：选择捕获的异常类型
- Finally：在组件结束时执行，不论是否出现异常，都会执行

### 调试技术/方法

云扩 RPA 编辑器提供了多种调试技术，用于检查 RPA 流程在进入实际生产环境前，是否能够成功运行，或查找错误以纠正错误。

- 设置断点
- 停止
- 单步调试
    - 单步执行
    - 单步跳过
    - 单步跳出
- 调试文件
- 测试组件
- 从此组件调试

#### 设置断点

在调试工作流时，如果要将程序运行到特定的位置，可以在两者之间设置断点。
当我们必须在组件完全结束前停止时，设置断点非常有用。这时我们应该在前一个组件上使用断点（快捷键 F9）。

#### 停止

停止用于在某个点停止正在运行的 RPA 流程。假设我们有一个序列一起执行多个组件，我们希望在某个组件上执行。为此，我们可以使用停止选项。

#### 单步调试

单步调试的方法可通过如下三种方法：

- 单步执行
使用“单步执行”（快捷键 F11）进行调试，将逐步执行流程，一次调试一个组件。
- 单步跳过
使用“单步跳过”（快捷键 F10）进行调试，不会打开当前容器类组件，而是直接调试下一个组件。
此选项可跳过你不感兴趣的流程块，这样可以快速转到更感兴趣的流程块。
- 单步跳出
使用“单步跳出”（快捷键 Shift+F11）进行调试，会跳出当前容器内组件，并暂停调试。在暂停调试之前，会完成当前容器内的组件的执行。

#### 调试文件

当自动化项目比较复杂，而每一次调试或运行都耗费巨大的时间和人力，此时便可以使用 “调试文件”（F6），来将一个大型的项目拆分，进行调试当前已打开的文件。这样，便可以更快的对项目的正确性进行判断，更快完成项目的校验。

#### 测试组件

在自动化项目实施过程中，经常会遇到已定位到某个组件有报错异常，但无法更准确地定位到该组件的具体某一步骤错误，此时可在流程中选择该组件，在右键菜单中选择“测试组件”，进行调试选中的单个组件。

#### 从此组件调试

在编辑器里，如果流程中有多个组件，需要指定从某一个组件开始调试，则可以在编辑区域中选中需要开始调试的组件，在右键快捷菜单中选择“ 从此组件调试” 选项, 将从选定的该组件开始进行调试当前及之后的组件。

### 使用日志记录排查错误

除了在云扩 RPA 编辑器的输出面板中，查看流程运行的状态和发生错误的提示，我们还可以在独立的日志文件中查找到详细的记录。

‒ 编辑器

    ‒ 系统日志的默认路径：%UserProfile%\AppData\Local\Encoo\Log

    ‒ 安装日志的默认路径：%UserProfile%\AppData\Local\Encoo\Installation

‒ 机器人

    ‒ 系统日志的默认路径：%programfiles(x86)%\Encoo Robot\Logs

    ‒ 安装日志的默认路径：%UserProfile%\AppData\Local\Encoo\Installation

    ‒ 流程执行的任务记录日志的默认路径：%UserProfile%\AppData\Local\Encoo\Encoo Robot\JobLogs

根据流程的异常情况，在以上路径中，根据时间戳查找到对应的 log 文件，在文本编辑器/记录本中打开 log 文件，找到第一次出现 "[Error]" 字样的的那一行所在的日志，进行分析查找原因。

## 常见异常及处理方法

在运行和设计 RPA 流程时，会出现各种异常和问题，下面介绍遇到的一些常见异常及处理方法。

### 处理运行时异常

在云扩 RPA 编辑运行流程时，可能会遇到错误。要纠正这些错误，最好的方法是使用错误捕获组件，该组件可用于在运行时处理异常。
将序列或流程图放在 Try-Catch 组件中将有助于处理运行时异常。

### 动态观察对象引用未设置为对象的实例的错误

当没有提供某些变量所需的默认值时，通常会发生这种类型的错误。在这种情况下，我们需要为所需的变量提供一个默认值。

### 索引超出范围的错误

当试图通过超出范围的索引迭代数组元素时，会发生此错误。当我们不知道数组的大小，只是输入一个随机的索引来访问元素时，就会发生这种情况。
要解决此问题，必须检查数组或集合列表的索引范围。

### 因超时而找不到图像的错误

由于找不到图像，引发了此类异常。这可能是由于环境的变化，例如分辨率或主题设置。也可能是桌面程序中的某些元素渲染时间过长，此时需要适当添加延迟，等待元素出现。

## 如何避免一些常见的错误

- 【思路清晰】：在设计流程模块的时候，应当尽量理清自己的思路，用尽量简洁的方式来实现想要的功能，或者使用模块化的方法来进行制作。同时可使用批注/注释记录设计思路。
- 【模块简洁】：一个流程序列当中，条件分支不宜过多，尽量通过分析将条件重新组合，以更加简便的方式来进行。同时循环嵌套也同样需要通过优化方案来尽量减少嵌套的数量。
- 【独立的功能】：能够重复使用的功能呢，为了实现可重用性和扩展性，建议写成独立的子流程，定义好相关的参数由外部程序调用。
- 【善用变量】：将常用数据通过变量或列表进行存储，方便统一修改和使用，减少出错几率。
- 【分段制作】：将一个复杂的功能拆分为多个小功能任务，分步骤进行制作，并且对每一次实现的功能进行测试。
- 【及时测试】：尽量在每一次修改或者完成一小部分的制作后及时进行测试和修改。不要将可能存在的错误留到最后才发现，这样就容易留下各种奇怪的问题，同时难以定位错误的具体原因。
